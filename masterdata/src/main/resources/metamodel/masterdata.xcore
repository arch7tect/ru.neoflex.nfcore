@GenModel(
    bundleManifest="false",
    modelDirectory="ru.neoflex.nfcore.reports/src/java/java-gen",
    complianceLevel="7.0",
    rootExtendsClass="org.eclipse.emf.ecore.impl.MinimalEObjectImpl",
    rootExtendsInterface="org.eclipse.emf.ecore.EObject"
)
package ru.neoflex.nfcore.masterdata
import ru.neoflex.nfcore.base.types.QName

abstract class BaseType {
    op boolean isPlain() {false}
    op boolean isStructure() {false}
    op boolean isArray() {false}
    op boolean isMap() {false}
    op boolean isShape() {false}
    op BaseType actualType() {this}
}

class PlainType extends BaseType {
    String javaClassName
    op boolean isPlain() {true}
}

class Field {
    container Structure structure opposite fields
    String name
    contains BaseType fieldType
}

class Structure extends BaseType {
    contains Field[] fields opposite structure
    op boolean isStructure() {true}
}

class Array extends BaseType {
    contains BaseType elementType
    op boolean isArray() {true}
}

class Map extends BaseType {
    contains BaseType valueType
    op boolean isMap() {true}
}

enum ShapeType {
    Point
    MultiPoint
    LineString
    MultiLineString
    Polygon
    MultiPolygon
    Rectangle
    GeometryCollection
}

class Shape extends BaseType {
    ShapeType shapeType
    op boolean isShape() {true}
}

class NamedType extends BaseType {
    QName name
    contains BaseType baseType
    op boolean isPlain() {baseType.isPlain()}
    op boolean isStructure() {baseType.isStructure()}
    op boolean isArray() {baseType.isArray()}
    op boolean isMap() {baseType.isMap()}
    op boolean isShape() {baseType.isShape()}
    op BaseType actualType() {baseType}
}

abstract class Feature {
    container Entity entity opposite features
    String name
    boolean isTimeDependent
    boolean isMany
    op boolean isAttribute() {false}
    op boolean isReference() {false}
}

class Attribute extends Feature {
    refers NamedType attributeType
    op boolean isAttribute() {true}
}

class Reference extends Feature {
    refers Entity referenceEntity
    op boolean isReference() {true}
}

abstract class Index {
    String name
    refers Feature[] features
    op boolean isPrimaryKey() {false}
}

@Ecore(constraints="IsValid")
class PrimaryKey extends Index {
    container Entity entity opposite primaryKey
    op boolean isPrimaryKey() {true}
    op boolean isForeignKey() {false}
    op boolean isInvertedEntry() {false}
    op boolean isPlainIndex() {false}
    op boolean isFulltextIndex() {false}
    op boolean isSpatialIndex() {false}
}

@Ecore(constraints="IsValid")
class ForeignKey extends Index {
    container Entity entity opposite foreignKeys
    refers Entity foreignEntity
    op boolean isForeignKey() {true}
}

@Ecore(constraints="IsValid")
abstract class InvertedEntry extends Index {
    container Entity entity opposite invertedEntries
    op boolean isInvertedEntry() {true}
}

class PlainIndex extends InvertedEntry {
    boolean isUnique
    op boolean isPlainIndex() {true}
}

class FulltextIndex extends InvertedEntry {
    op boolean isFulltextIndex() {true}
}

class SpatialIndex extends InvertedEntry {
    op boolean isSpatialIndex() {true}
}

class Entity {
    QName name
    refers Entity[] superTypes
    contains Feature[] features opposite entity
    contains PrimaryKey primaryKey opposite entity
    contains InvertedEntry[] invertedEntries opposite entity
    contains ForeignKey[] foreignKeys opposite entity
}
